<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temario Ejercicio Power BI: FerroIberia</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Tipografía Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Oculta el marcador por defecto de <details> */
        summary {
            list-style: none; /* Para Firefox */
        }
        summary::-webkit-details-marker {
            display: none; /* Para Chrome/Safari */
        }
        /* Animación del icono '+' */
        details[open] .plus-minus {
            transform: rotate(45deg);
        }
        /* Estilo para el bloque de código */
        pre code {
            font-family: 'Consolas', 'Monaco', 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            background-color: #2d3748; /* gray-800 */
            color: #90cdf4; /* blue-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 1rem;
            display: block;
            overflow-x: auto;
        }
        /* Estilos para las tablas de previsualización */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem; /* text-sm */
            margin-top: 0.75rem; /* mt-3 */
        }
        .preview-table th, .preview-table td {
            border: 1px solid #e2e8f0; /* border-gray-300 */
            padding: 0.5rem; /* p-2 */
            text-align: left;
        }
        .preview-table th {
            background-color: #f7fafc; /* bg-gray-50 */
            font-weight: 600; /* font-semibold */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <!-- Encabezado -->
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-900 mb-2">Ejercicio Power BI: Análisis "FerroIberia"</h1>
            <p class="text-lg text-gray-600">Un manual interactivo para construir tu informe de análisis operativo.</p>
        </header>

        <!-- Introducción -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-semibold text-blue-800 mb-3">Objetivo del Ejercicio</h2>
            
            <h3 class="text-lg font-semibold text-gray-800 mt-4 mb-2">El Escenario</h3>
            <p class="text-gray-700 mb-3">Eres el analista de datos principal de "FerroIberia", la compañía nacional de trenes. La dirección quiere un informe unificado para analizar el rendimiento de los pasajeros, la puntualidad y la ocupación de los trenes, pero no tienen una visión clara de la situación.</p>
            
            <h3 class="text-lg font-semibold text-gray-800 mt-4 mb-2">El Desafío: Datos Fragmentados</h3>
            <p class="text-gray-700 mb-3">Los datos están dispersos en múltiples sistemas y formatos. Tenemos:</p>
            <ul class="list-disc pl-5 text-gray-700 space-y-1">
                <li>Registros de viajes del año en curso en un archivo <strong>CSV</strong>.</li>
                <li>Datos históricos del año pasado en un archivo <strong>Excel</strong> con nombres de columna diferentes.</li>
                <li>Maestros de <strong>Líneas</strong>, <strong>Estaciones</strong> y <strong>Flota</strong> en archivos separados.</li>
            </ul>

            <h3 class="text-lg font-semibold text-gray-800 mt-4 mb-2">El Objetivo: Un Informe Integral</h3>
            <p class="text-gray-700">Nuestro objetivo es construir un informe de Power BI "de principio a fin". Esto implica:</p>
            <ul class="list-disc pl-5 text-gray-700 space-y-2">
                <li><strong>Limpiar y Unificar</strong> todos los datos en un modelo de estrella robusto (Fase 1 y 2).</li>
                
                <li><strong>Crear KPIs (Medidas DAX):</strong> No solo sumaremos columnas. Definiremos la "lógica de negocio" en fórmulas DAX centralizadas (Medidas). Esto nos permite crear cálculos complejos una sola vez (ej. <i>% Ocupación Media</i>, <i>Ingresos Año Anterior</i>) y reutilizarlos en todo el informe, garantizando que todos vean el mismo número y que la lógica esté en un solo lugar.</li>
                
                <!-- PUNTO 3 REESCRITO Y AMPLIADO -->
                <li><strong>Responder Preguntas de Negocio con Visuales:</strong> El objetivo final no es hacer gráficos, sino responder preguntas concretas. Cada visualización tendrá un propósito claro:
                    <ul class="list-circle pl-6 mt-2 text-gray-600 space-y-2">
                        <li><b>¿Cuál es nuestro rendimiento general?</b>
                            <br>Responderemos a esto con las <strong>Tarjetas de KPIs</strong> (`[Total Ingresos]`, `[Total Pasajeros]`, `[% de Viajes con Retraso]`) en la parte superior de la Página 1.</li>
                        
                        <li><b>¿Estamos mejorando o empeorando?</b>
                            <br>Lo veremos en el <strong>Gráfico de Área</strong> que compara `[Total Ingresos]` de este año contra `[Ingresos PY]` (Año Anterior), mes a mes.</li>
                        
                        <li><b>¿Quiénes son los responsables del rendimiento?</b>
                            <br>Lo identificaremos con el <strong>Gráfico de Barras Horizontales</strong>, creando un ranking de `[Total Ingresos]` por `[Jefe_Regional]`.</li>
                        
                        <li><b>¿Dónde están los cuellos de botella?</b>
                            <br>Responderemos a esto de dos formas:
                            <br>1. Con los <strong>Gráficos de Anillos</strong> de "Origen vs. Destino" para ver las estaciones más congestionadas.
                            <br>2. Con la <strong>Matriz de Rendimiento</strong> en la Página 2, que usará formato condicional para resaltar las líneas con `[Retraso Medio (min)]` más altos.</li>
                        
                        <li><b>¿Son eficientes nuestros activos?</b>
                            <br>Lo analizaremos en la Página 2 con el <strong>Gráfico de Barras</strong> que mostrará el `[% Ocupacion Media]` por `[Modelo]` de tren.</li>
                    </ul>
                </li>
                
                <li><strong>Añadir Interactividad Avanzada</strong> (Drill-through, Marcadores) para que la dirección pueda explorar los datos por sí misma.</li>
            </ul>
        </div>


        <!-- SECCIÓN DE DESCARGA DE ARCHIVOS (MODIFICADA) -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-semibold text-blue-800 mb-3">Descarga de Archivos de Datos</h2>
            <p class="text-gray-700 mb-6">Descarga los archivos necesarios para completar el ejercicio. A continuación se detalla cada archivo, su propósito y una previsualización de sus datos.</p>
            
            <div class="space-y-6">

                <!-- Ficha 1: Viajes_2024.csv -->
                <div class="border rounded-lg p-4">
                    <a href="Viajes_2024.csv" download="Viajes_2024.csv" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold text-lg">
                        `Viajes_2024.csv`
                    </a>
                    <p class="text-sm text-gray-600 mt-1"><strong>Propósito:</strong> Tabla de Hechos (Fact). Contiene las transacciones de viajes del año en curso (formato nuevo).</p>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>ID_Viaje</th>
                                <th>Fecha</th>
                                <th>ID_Linea</th>
                                <th>Pasajeros</th>
                                <th>Ingresos</th>
                                <th>Retraso_Minutos</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>V-1001</td>
                                <td>2024-01-15</td>
                                <td>L-01</td>
                                <td>150</td>
                                <td>3000</td>
                                <td>5</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Ficha 2: Viajes_2023.xlsx -->
                <div class="border rounded-lg p-4">
                    <a href="Viajes_2023.xlsx" download="Viajes_2023.xlsx" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold text-lg">
                        `Viajes_2023.xlsx`
                    </a>
                    <p class="text-sm text-gray-600 mt-1"><strong>Propósito:</strong> Tabla de Hechos (Fact). Contiene las transacciones del año pasado (formato antiguo). Requiere renombrar columnas en Power Query.</p>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Viaje_Num</th>
                                <th>Fecha_Operacion</th>
                                <th>Cod_Linea</th>
                                <th>Pasajeros_Total</th>
                                <th>Ingreso_Total_EUR</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>H-501</td>
                                <td>2023-01-14</td>
                                <td>L-01</td>
                                <td>145</td>
                                <td>2900</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Ficha 3: Lineas.csv -->
                <div class="border rounded-lg p-4">
                    <a href="Lineas.csv" download="Lineas.csv" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold text-lg">
                        `Lineas.csv`
                    </a>
                    <p class="text-sm text-gray-600 mt-1"><strong>Propósito:</strong> Tabla de Dimensión (Dim). Maestro de Líneas, describe cada servicio (AVE, Cercanías, etc.).</p>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>ID_Linea</th>
                                <th>Nombre_Linea</th>
                                <th>Tipo_Servicio</th>
                                <th>Zona_Tarifaria</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>L-02</td>
                                <td>AVE Madrid-Sevilla</td>
                                <td>Alta Velocidad</td>
                                <td>Corredor Sur</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Ficha 4: Estaciones.xlsx -->
                <div class="border rounded-lg p-4">
                    <a href="Estaciones.xlsx" download="Estaciones.xlsx" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold text-lg">
                        `Estaciones.xlsx`
                    </a>
                    <p class="text-sm text-gray-600 mt-1"><strong>Propósito:</strong> Tabla de Dimensión (Dim). Maestro de Estaciones, incluye jerarquía de región y jefe regional.</p>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>ID_Estacion</th>
                                <th>Nombre_Estacion</th>
                                <th>Ciudad</th>
                                <th>Jefe_Regional</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>E-03</td>
                                <td>Madrid-Atocha</td>
                                <td>Madrid</td>
                                <td>Juan Pérez</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Ficha 5: Flota.csv -->
                <div class="border rounded-lg p-4">
                    <a href="Flota.csv" download="Flota.csv" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold text-lg">
                        `Flota.csv`
                    </a>
                    <p class="text-sm text-gray-600 mt-1"><strong>Propósito:</strong> Tabla de Dimensión (Dim). Maestro de Flota, describe cada tren y su capacidad máxima.</p>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>ID_Tren</th>
                                <th>Modelo</th>
                                <th>Capacidad_Maxima</th>
                                <th>Año_Fabricacion</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>T-20</td>
                                <td>S-102 'Pato'</td>
                                <td>350</td>
                                <td>2007</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Ficha 6: informe.png -->
                <div class="border rounded-lg p-4">
                    <a href="informe.png" download="informe.png" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold text-lg">
                        `informe.png`
                    </a>
                    <p class="text-sm text-gray-600 mt-1"><strong>Propósito:</strong> Imagen de la maqueta del informe final. Te servirá como guía visual para el diseño.</p>
                </div>
                
                <!-- Ficha 7: modelo_datos.png (NUEVA) -->
                <div class="border rounded-lg p-4">
                    <a href="modelo_datos.png" download="modelo_datos.png" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold text-lg">
                        `modelo_datos.png`
                    </a>
                    <p class="text-sm text-gray-600 mt-1"><strong>Propósito:</strong> Imagen del modelo de datos (esquema de estrella) que construiremos.</p>
                </div>

            </div>
        </div>
        <!-- FIN DE LA SECCIÓN DE DESCARGA -->

        <!-- Imagen del Resultado Esperado -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-semibold text-blue-800 mb-3">Resultado Esperado del Informe</h2>
            <p class="text-gray-700 mb-4">Esta imagen es una maqueta realista del informe final que construiremos. Te servirá como guía visual durante el ejercicio.</p>
            <!-- La imagen se cargará desde tu repositorio local de GitHub Pages -->
            <img src="informe.png" alt="Maqueta del informe final de Power BI para FerroIberia" class="w-full rounded-lg shadow-lg border border-gray-200">
            
            <!-- *** NUEVA SECCIÓN: GUÍA VISUAL *** -->
            <div class="mt-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-3">Guía Visual del Informe</h3>
                <p class="text-gray-700 mb-4">A continuación, se detalla el propósito de cada objeto visual en la maqueta, siguiendo un orden de lectura de arriba a abajo y de izquierda a derecha:</p>
                <ol class="list-decimal pl-5 space-y-3 text-gray-700">
                    <li><strong>Filtros de Segmentación (Izquierda, Arriba):</strong> Permiten al usuario filtrar toda la página por `Año`, `Región` y `Tipo de Servicio`. Son los controles principales del informe.</li>
                    <li><strong>Tarjetas de KPIs (Arriba, Centro):</strong> Muestran los cuatro indicadores de rendimiento más importantes de un vistazo (`Total Pasajeros`, `Total Ingresos`, `% Retraso Medio`, `% de Viajes con Retraso`). Responden a: "¿Cómo vamos en general?".</li>
                    <li><strong>Gráficos de Anillos (Arriba, Derecha):</strong> Muestran el "Top 5 Estaciones de Origen" y "Top 5 Estaciones de Destino". Son clave para identificar cuellos de botella y las rutas más populares.</li>
                    <li><strong>Ingresos por Jefe Regional (Izquierda, Medio):</strong> Un gráfico de barras horizontales que crea un ranking de rendimiento por persona. Responde a: "¿Quiénes son los responsables del rendimiento?".</li>
                    <li><strong>Rendimiento Anual (Centro):</strong> Es un gráfico de área que compara los ingresos de este año con los del año pasado (`Ingresos PY`). Responde a: "¿Estamos mejorando o empeorando?".</li>
                    <li><strong>Rendimiento - Detalle de Líneas (Derecha, Medio):</strong> Una matriz que desglosa las métricas por cada línea de tren. Usará formato condicional para resaltar los peores retrasos.</li>
                    <li><strong>Pasajeros vs. Retraso (Izquierda, Abajo):</strong> Un gráfico combinado que superpone los pasajeros (columnas) y los retrasos (línea) a lo largo del tiempo. Responde a: "¿Los retrasos afectan a la demanda de pasajeros?".</li>
                    <li><strong>% Ocupación por Modelo (Derecha, Abajo):</strong> Un gráfico de barras que muestra la eficiencia de cada modelo de tren. Responde a: "¿Estamos usando nuestros activos de forma eficiente?".</li>
                </ol>
            </div>
            <!-- *** FIN DE LA NUEVA SECCIÓN *** -->

        </div>

        <!-- Acordeón de Fases -->
        
        <!-- Fase 1: Extracción y Transformación (Power Query) -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 1: Extracción y Transformación (Power Query)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p><strong>Intención:</strong> Limpiar y unificar los datos brutos de diferentes fuentes en un conjunto de tablas limpio y listo para el modelado.</p>
                <ul class="list-disc pl-5 space-y-4">
                    <li><strong>Cargar Orígenes:</strong> Carga los 5 archivos a Power Query ("Transformar datos").</li>
                    
                    <li><strong>Unificar Tablas de Viajes (Método Recomendado):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Selecciona la consulta `Viajes_2023`.</li>
                            <li>Renombra todas sus columnas para que coincidan <strong>exactamente</strong> con `Viajes_2024` (ej. `Fecha_Operacion` -> `Fecha`, `Cod_Linea` -> `ID_Linea`, etc.).</li>
                            <li>Ve a la pestaña "Inicio" > "Combinar" > "Anexar consultas" > <strong>"Anexar consultas como nueva"</strong>.</li>
                            <li>En la ventana, anexa `Viajes_2024` (como tabla principal) y `Viajes_2023` (como segunda tabla).</li>
                            <li>Renombra esta nueva consulta unificada (que tiene ~500 filas) a `Viajes` (o `VIAJES` si prefieres tus nombres).</li>
                        </ul>
                    </li>
                    
                    <li><strong>Renombrar Consultas de Dimensión:</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>(Opcional, recomendado) Renombra `Lineas` a `Dim_Lineas`, `Estaciones` a `Dim_Estaciones`, `Flota` a `Dim_Flota`.</li>
                        </ul>
                    </li>
                    
                    <li><strong>Limpiar Tipos de Datos:</strong> En `Viajes`, asegura que `Fecha` sea tipo *Fecha*, `Pasajeros` y `Retraso_Minutos` sean *Número entero*, e `Ingresos` sea *Número decimal*.</li>
                    
                    <li><strong>Deshabilitar Carga:</strong> Haz clic derecho en las consultas originales `Viajes_2024` y `Viajes_2023` y desmarca "Habilitar carga". Esto es crucial para no cargar datos duplicados y mantener el modelo limpio.</li>
                    
                    <li><strong>Cargar y Aplicar:</strong> Haz clic en "Cerrar y aplicar".</li>
                </ul>
            </div>
        </details>
        
        <!-- Fase 2: Modelado de Datos -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 2: Modelado de Datos (Esquema de Estrella)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p><strong>Intención:</strong> Construir un modelo de datos robusto que permita que los filtros fluyan correctamente desde las dimensiones a los hechos.</p>
                
                <div class="my-4">
                    <h4 class="font-semibold text-lg text-gray-800 mb-2">Esquema del Modelo de Datos</h4>
                    <p class="text-sm text-gray-600 mb-3">Este es el esquema de estrella que crearemos. Observa la relación de doble rol (activa e inactiva) de la tabla de Estaciones.</p>
                    <!-- La imagen se cargará desde tu repositorio local de GitHub Pages -->
                    <img src="modelo_datos.png" alt="Esquema del modelo de datos de Power BI" class="w-full rounded-lg shadow-md border border-gray-200">
                </div>

                <ul class="list-disc pl-5 space-y-4">
                    <li><strong>Crear `Dim_Calendario` (DAX):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Ve a "Vista de datos" > "Nueva tabla".</li>
                            <li>Usa el código DAX (ver Fase 3) para crear `Dim_Calendario`.</li>
                            <li>En "Herramientas de tabla", <strong>Marcar como tabla de fechas</strong> usando la columna `[Date]`. Esto es <strong>obligatorio</strong> para las funciones de Time Intelligence.</li>
                        </ul>
                        
                        <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md">
                            <h4 class="font-semibold text-lg text-blue-800 mb-3">Nota: ¿Por qué este método? (DAX vs. Power Query vs. Auto)</h4>
                            <p class="text-sm text-gray-700 mb-3">Hemos discutido 3 formas de crear tablas de calendario. Aquí tienes un resumen de por qué elegimos este método:</p>
                            
                            <ol class="list-decimal pl-5 space-y-3">
                                <li>
                                    <strong class="text-gray-800">Método 1: `ADDCOLUMNS(CALENDARAUTO())` (El que usamos)</strong>
                                    <ul class="list-disc pl-5 text-sm">
                                        <li><strong>Pro:</strong> Control total, eficiente (una sola tabla), optimizado para DAX Time Intelligence. Es la práctica recomendada.</li>
                                        <li><strong>Con:</strong> Requiere escribir código DAX.</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong class="text-gray-800">Método 2: Jerarquía Automática de Power BI ("Auto Date/Time")</strong>
                                    <ul class="list-disc pl-5 text-sm">
                                        <li><strong>Pro:</strong> Cero esfuerzo, es automático.</li>
                                        <li><strong>Con:</strong> Mala práctica. Crea tablas ocultas ineficientes para *cada* campo de fecha, infla el modelo y no es flexible.</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong class="text-gray-800">Método 3: Crearla en Power Query (con clics)</strong>
                                    <ul class="list-disc pl-5 text-sm">
                                        <li><strong>Pro:</strong> Muy visual, fácil de combinar con otras fuentes (ej. un Excel de festivos).</li>
                                        <li><strong>Con:</strong> Definir el rango de fechas dinámicamente es un poco más complejo que con `CALENDARAUTO()`.</li>
                                    </ul>
                                </li>
                            </ol>
                            <p class="text-sm font-medium text-blue-700 mt-3"><strong>Conclusión:</strong> El método DAX `ADDCOLUMNS` es la práctica recomendada por ser el más robusto, eficiente y escalable.</p>
                        </div>
                    </li>
                    <li><strong>Crear Relaciones (Vista de Modelo):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>`Dim_Calendario[Date]` (1) -> `Viajes[Fecha]` (*)</li>
                            <li>`Dim_Lineas[ID_Linea]` (1) -> `Viajes[ID_Linea]` (*)</li>
                            <li>`Dim_Flota[ID_Tren]` (1) -> `Viajes[ID_Tren]` (*)</li>
                        </ul>
                    </li>
                    <li><strong>Reto: Relaciones de Doble Rol (Estaciones):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Crea una relación <strong>ACTIVA</strong>: `Dim_Estaciones[ID_Estacion]` (1) -> `Viajes[ID_Estacion_Origen]` (*)</li>
                            <li>Crea una relación <strong>INACTIVA</strong>: `Dim_Estaciones[ID_Estacion]` (1) -> `Viajes[ID_Estacion_Destino]` (*). (Power BI la creará inactiva automáticamente).</li>
                        </ul>
                    </li>
                    <li><strong>Ocultar Claves Foráneas:</strong> En `Viajes`, oculta todas las columnas de ID (`ID_Linea`, `ID_Tren`, `ID_Estacion_Origen`, `ID_Estacion_Destino`, `Fecha`) de la vista de informe.</li>
                </ul>
            </div>
        </details>

        <!-- Fase 3: Medidas Avanzadas (DAX) -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 3: Medidas Avanzadas (DAX)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p><strong>Intención:</strong> Crear los KPIs (Indicadores Clave de Rendimiento) que encapsulen la lógica de negocio y sean reutilizables en todo el informe. (Sugerencia: crea una "Tabla de Medidas" para organizarlas).</p>

                <p class="font-semibold text-lg mt-2">Código `Dim_Calendario`:</p>
                <div class="bg-gray-50 p-3 rounded-lg border">
<pre><code>Dim_Calendario = 
ADDCOLUMNS (
    CALENDARAUTO(),
    "Año", YEAR ( [Date] ),
    "Mes", FORMAT ( [Date], "MMMM" ),
    "NumMes", MONTH ( [Date] ),
    "AñoMes", FORMAT ( [Date], "YYYY-MM" )
)
</code></pre>
                    <p class="text-sm mt-2 text-gray-600"><strong>Propósito:</strong> Crea la tabla de fechas. <strong>`CALENDARAUTO()`</strong> escanea el modelo y crea una fila por cada día. <strong>`ADDCOLUMNS`</strong> añade columnas útiles (Año, Mes, etc.) para poder filtrar.</p>
                </div>
                
                <p class="font-semibold text-lg mt-2">Medidas Básicas:</p>
                <div class="bg-gray-50 p-3 rounded-lg border">
<pre><code>Total Pasajeros = SUM(Viajes[Pasajeros])
Total Ingresos = SUM(Viajes[Ingresos])
Total Viajes = COUNTROWS(Viajes)
Retraso Medio (min) = AVERAGE(Viajes[Retraso_Minutos])
</code></pre>
                    <p class="text-sm mt-2 text-gray-600"><strong>Propósito:</strong> Agregaciones simples que calculan los totales y el promedio de retraso. <strong>`SUM`</strong> suma una columna, <strong>`COUNTROWS`</strong> cuenta filas y <strong>`AVERAGE`</strong> calcula la media.</p>
                </div>

                <p class="font-semibold text-lg mt-2">Medidas de Rendimiento:</p>
                <div class="bg-gray-50 p-3 rounded-lg border">
<pre><code>% de Viajes con Retraso = 
VAR ViajesConRetraso = 
    CALCULATE(
        [Total Viajes],
        Viajes[Retraso_Minutos] &gt; 0
    )
RETURN
    DIVIDE( ViajesConRetraso, [Total Viajes] )

% Ocupacion Media = 
AVERAGEX(
    Viajes,
    DIVIDE(
        Viajes[Pasajeros],
        RELATED(Dim_Flota[Capacidad_Maxima])
    )
)
</code></pre>
                    <p class="text-sm mt-2 text-gray-600"><strong>`% de Viajes con Retraso`</strong>: Usa <strong>`CALCULATE`</strong> para modificar el contexto de filtro y contar solo los viajes donde `Retraso_Minutos > 0`. Luego <strong>`DIVIDE`</strong> de forma segura (evita errores de división por cero).</p>
                    <p class="text-sm mt-2 text-gray-600"><strong>`% Ocupacion Media`</strong>: Usa <strong>`AVERAGEX`</strong> para iterar fila por fila de la tabla `Viajes`. En cada fila, usa <strong>`RELATED`</strong> para "saltar" de la tabla `Viajes` a `Dim_Flota` (a través de la relación) y coger la `Capacidad_Maxima` de ese tren. Finalmente, calcula el promedio de todas esas ocupaciones individuales.</p>
                </div>

                <p class="font-semibold text-lg mt-2">Medidas de Time Intelligence:</p>
                <div class="bg-gray-50 p-3 rounded-lg border">
<pre><code>Ingresos PY = 
CALCULATE(
    [Total Ingresos],
    SAMEPERIODLASTYEAR(Dim_Calendario[Date])
)

Crecimiento Ingresos YoY = 
DIVIDE( [Total Ingresos] - [Ingresos PY], [Ingresos PY] )
</code></pre>
                    <p class="text-sm mt-2 text-gray-600"><strong>`Ingresos PY`</strong>: Usa <strong>`SAMEPERIODLASTYEAR`</strong> (MismoPeriodoAñoAnterior) para coger el contexto de fechas actual (ej. "Marzo 2024") y desplazarlo automáticamente un año atrás ("Marzo 2023"). Esto solo funciona si has marcado tu `Dim_Calendario` como tabla de fechas.</p>
                </div>
                
                <p class="font-semibold text-lg mt-2">Medida de Relación Inactiva (El Reto):</p>
                <div class="bg-gray-50 p-3 rounded-lg border">
<pre><code>Viajes por Destino = 
CALCULATE(
    [Total Viajes],
    USERELATIONSHIP(
        Dim_Estaciones[ID_Estacion],
        Viajes[ID_Estacion_Destino]
    )
)
</code></pre>
                    <p class="text-sm mt-2 text-gray-600"><strong>Propósito:</strong> Por defecto, `[Total Viajes]` se filtra por `ID_Estacion_Origen` (la relación activa). Esta medida usa <strong>`USERELATIONSHIP`</strong> para "encender" temporalmente la relación inactiva con `ID_Estacion_Destino` solo durante este cálculo.</p>
                </div>
            </div>
        </details>
        
        <!-- Fase 4: Visualización -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 4: Visualización e Interactividad</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p><strong>Intención:</strong> Construir un informe de 2 páginas que presente los datos de forma clara y permita la exploración.</p>
                
                <h4 class="font-semibold text-lg">Página 1: Resumen Operativo</h4>
                <ul class="list-disc pl-5 space-y-4">
                    <li><strong>KPIs (Tarjetas):</strong> `[Total Pasajeros]`, `[Total Ingresos]`, `[Retraso Medio (min)]`, `[% Ocupacion Media]`, `[% de Viajes con Retraso]`.
                        <br><strong>Intención:</strong> Dar una visión general e instantánea de los indicadores más importantes.</li>
                    
                    <li><strong>Filtros (Slicers):</strong> `Dim_Calendario[Año]`, `Dim_Estaciones[Region]`, `Dim_Lineas[Tipo_Servicio]`.
                        <br><strong>Intención:</strong> Permitir al usuario segmentar todo el informe por las dimensiones de negocio clave.</li>
                    
                    <li><strong>Tendencia Anual (Gráfico de Área):</strong> Eje X: `Dim_Calendario[Mes]`. Eje Y: `[Total Ingresos]` y `[Ingresos PY]`.
                        <br><strong>Intención:</strong> Comparar el rendimiento de ingresos actual con el del año pasado, mes a mes.
                        <br><strong class="text-red-600">¡Nota Importante!</strong> Si los meses salen en desorden (Abril, Agosto...), ve a la "Vista de Datos", selecciona la columna `Mes` y, en "Herramientas de Columnas", usa "Ordenar por columna" para ordenarla por `NumMes`.</li>
                    
                    <li><strong>Ingresos por Jefe Regional (Gráfico de Barras horizontales):</strong> Eje Y: `Dim_Estaciones[Jefe_Regional]`. Eje X: `[Total Ingresos]`.
                        <br><strong>Intención:</strong> Identificar el rendimiento por responsable de región. Se usan barras horizontales porque los nombres de los jefes son largos y se leen mejor.</li>
                    
                    <li><strong>Reto Origen vs. Destino (Gráficos de Anillos):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li><strong>Anillo Origen:</strong> Leyenda: `Dim_Estaciones[Nombre_Estacion]`. Valores: `[Total Viajes]`. (Usa un filtro N-Superior = 5).</li>
                            <li><strong>Anillo Destino:</strong> Leyenda: `Dim_Estaciones[Nombre_Estacion]`. Valores: `[Viajes por Destino]`. (Usa un filtro N-Superior = 5).</li>
                        </ul>
                        <strong>Intención:</strong> Comparar rápidamente las estaciones más populares de salida (usando la relación activa) y de llegada (usando la medida `[Viajes por Destino]` con la relación inactiva).
                    </li>
                </ul>
                
                <h4 class="font-semibold text-lg mt-4">Página 2: Análisis de Puntualidad y Flota</h4>
                <ul class="list-disc pl-5 space-y-4">
                    <li><strong>Drill-through (Obtención de detalles):</strong> Configura esta página para que sea un destino de Drill-through desde `Dim_Lineas[Tipo_Servicio]`.
                        <br><strong>Intención:</strong> Permitir al usuario saltar desde un resumen en la Página 1 (ej. "Cercanías") a esta página para ver un desglose detallado *solo* de "Cercanías".</li>
                    
                    <li><strong>Matriz de Rendimiento:</strong> Filas: `Dim_Lineas[Nombre_Linea]`. Valores: `[Total Viajes]`, `[Retraso Medio (min)]`, `[% de Viajes con Retraso]`.
                        <br><strong>Intención:</strong> Ver el rendimiento detallado por línea específica.</li>
                    
                    <li><strong>Formato Condicional:</strong> En la matriz, aplica "Barras de datos" (rojas) a la columna `[Retraso Medio (min)]`.
                        <br><strong>Intención:</strong> Identificar visual e instantáneamente las líneas con peores retrasos.</li>
                    
                    <li><strong>Correlación (Gráfico Combinado):</strong> Eje X: `Dim_Calendario[Mes]`. Columnas (Y): `[Total Pasajeros]`. Líneas (Y): `[Retraso Medio (min)]`.
                        <br><strong>Intención:</strong> Analizar la correlación entre dos métricas. Responde a: "¿Los retrasos (línea) impactan el volumen de pasajeros (columnas) al mes siguiente?".</li>
                    
                    <li><strong>Detalle de Flota (Gráfico de Barras):</strong> Eje Y: `Dim_Flota[Modelo]`. Eje X: `[% Ocupacion Media]`.
                        <br><strong>Intención:</strong> Analizar la eficiencia de los modelos de tren *usados en el Tipo de Servicio seleccionado*. Responde a: "Para Cercanías, ¿qué modelo se llena más?".</li>
                </ul>
            </div>
        </details>

        <!-- Fase 4 (Avanzada): Marcadores y Filtros Globales -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 4 (Avanzada): Interacción y Filtros Globales</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p><strong>Intención:</strong> Añadir capas de interactividad profesional al informe.</p>
                
                <h4 class="font-semibold text-lg">Reto 1: Navegación con Marcadores (Bookmarks)</h4>
                <p>Vamos a crear dos botones en la Página 1 para alternar un gráfico entre "Ver Ingresos" y "Ver Pasajeros".</p>
                <ol class="list-decimal pl-5 space-y-2">
                    <li><strong>Activar Paneles:</strong> Ve a la pestaña "Ver" y activa el panel de "Marcadores" (Bookmarks) y el panel de "Selección".</li>
                    <li><strong>Crear Gráficos:</strong> En la Página 1, crea dos gráficos de barras y ponlos *exactamente en el mismo sitio*, uno encima del otro:
                        <ul class="list-circle pl-6 mt-2">
                            <li><strong>Gráfico A:</strong> Ingresos por `Dim_Lineas[Tipo_Servicio]`</li>
                            <li><strong>Gráfico B:</strong> Pasajeros por `Dim_Lineas[Tipo_Servicio]`</li>
                        </ul>
                    </li>
                    <li><strong>Crear Marcador "Ver Ingresos":</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>En el panel de "Selección", oculta el Gráfico B (Pasajeros) haciendo clic en el icono del ojo.</li>
                            <li>Asegúrate de que el Gráfico A (Ingresos) esté visible.</li>
                            <li>En el panel "Marcadores", haz clic en "Añadir". Renombra el marcador a "Ver Ingresos".</li>
                            <li>Haz clic en los "..." del marcador y desmarca la opción "Datos" (¡muy importante! para que el marcador solo cambie la visibilidad, no los filtros).</li>
                        </ul>
                    </li>
                    <li><strong>Crear Marcador "Ver Pasajeros":</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Ahora, en "Selección", oculta el Gráfico A (Ingresos) y muestra el Gráfico B (Pasajeros).</li>
                            <li>En "Marcadores", haz clic en "Añadir". Renombra el marcador a "Ver Pasajeros".</li>
                            <li>Haz clic en los "..." y desmarca "Datos".</li>
                        </ul>
                    </li>
                    <li><strong>Crear Botones:</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Ve a "Insertar" > "Botones" > "En blanco". Crea dos botones.</li>
                            <li>En el panel "Formato" del primer botón, activa "Acción", selecciona "Tipo" = "Marcador" y "Marcador" = "Ver Ingresos".</li>
                            <li>Haz lo mismo para el segundo botón, pero asígnalo al marcador "Ver Pasajeros".</li>
                        </ul>
                    </li>
                    <li>Prueba tus botones (usando Ctrl + Clic en el Desktop).</li>
                </ol>

                <h4 class="font-semibold text-lg mt-4">Reto 2: Filtro Global del Informe</h4>
                <p>Vamos a filtrar *todo el informe* (todas las páginas) para que solo muestre datos de "Alta Velocidad".</p>
                <ol class="list-decimal pl-5 space-y-2">
                    <li><strong>Activar Panel:</strong> Asegúrate de que el panel "Filtros" esté visible (pestaña "Ver").</li>
                    <li><strong>Añadir Filtro:</strong> Arrastra `Dim_Lineas[Tipo_Servicio]` al panel "Filtros".</li>
                    <li><strong>Configurar Alcance:</strong> Arrástralo a la tarjeta que dice "Filtros de todas las páginas".</li>
                    <li><strong>Aplicar Filtro:</strong> En la tarjeta del filtro, selecciona "Alta Velocidad".</li>
                    <li>Ahora, todas las páginas de tu informe (Página 1, Página 2...) estarán filtradas por "Alta Velocidad".</li>
                </ol>
            </div>
        </details>

        <!-- Fase 5: Preguntas de Negocio -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 5: Preguntas de Negocio (Validación)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p><strong>Intención:</strong> Usar el informe interactivo final para encontrar las respuestas a preguntas de negocio específicas.</p>
                <ol class="list-decimal pl-5 space-y-4">
                    <li>
                        <strong>Pregunta:</strong> ¿Cuál fue el `Total Ingresos` y el `Retraso Medio` del "Alta Velocidad" en la región "Cataluña" durante 2024?
                        <br><strong>Respuesta:</strong> En la Página 1, selecciona los filtros "2024", "Cataluña" y "Alta Velocidad". Lee las tarjetas de KPI.
                    </li>
                    <li>
                        <strong>Pregunta:</strong> ¿Qué Jefe Regional (`Jefe_Regional`) gestiona las estaciones con más viajes (como origen)?
                        <br><strong>Respuesta:</strong> En la Página 1, mira el gráfico de "Ingresos por Jefe Regional". (Nota: el gráfico es de ingresos. ¡Podrías cambiar el gráfico a `[Total Viajes]` o usar los marcadores que creaste para responderla con más precisión!).
                    </li>
                    <li>
                        <strong>Pregunta:</strong> Usando la Página 1, ¿cuál es la estación de destino (`Nombre_Estacion`) más popular?
                        <br><strong>Respuesta:</strong> Mira el gráfico "Top 5 Estaciones de Destino".
                    </li>
                    <li>
                        <strong>Pregunta:</strong> Usando el drill-through a la Página 2 para "Cercanías", ¿qué línea (`Nombre_Linea`) tiene el peor `[% de Viajes con Retraso]`?
                        <br><strong>Respuesta:</strong> En la Página 1, haz clic derecho en el filtro "Cercanías" > "Obtención de detalles" > "Análisis Detalle". Mira la matriz en la Página 2.
                    </li>
                    <li>
                        <strong>Pregunta (Avanzada):</strong> Usando los marcadores, ¿el "Tipo de Servicio" con más ingresos es también el que tiene más pasajeros?
                        <br><strong>Respuesta:</strong> En la Página 1, alterna los botones "Ver Ingresos" y "Ver Pasajeros" y compara los gráficos.
                    </li>
                </ol>
            </div>
        </details>
        
        <footer class="text-center text-gray-500 mt-8">
            <p>Fin del ejercicio. ¡Buen trabajo!</p>
        </footer>
    </div>

</body>
</html>
