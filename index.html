<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temario Ejercicio Power BI: FerroIberia</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Tipografía Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Oculta el marcador por defecto de <details> */
        summary {
            list-style: none; /* Para Firefox */
        }
        summary::-webkit-details-marker {
            display: none; /* Para Chrome/Safari */
        }
        /* Animación del icono '+' */
        details[open] .plus-minus {
            transform: rotate(45deg);
        }
        /* Estilo para el bloque de código */
        pre code {
            font-family: 'Consolas', 'Monaco', 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            background-color: #2d3748; /* gray-800 */
            color: #90cdf4; /* blue-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 1rem;
            display: block;
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <!-- Encabezado -->
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-900 mb-2">Ejercicio Power BI: Análisis "FerroIberia"</h1>
            <p class="text-lg text-gray-600">Un manual interactivo para construir tu informe de análisis operativo.</p>
        </header>

        <!-- Introducción -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-semibold text-blue-800 mb-3">Objetivo del Ejercicio</h2>
            <p class="text-gray-700">Crear un informe integral que analice el rendimiento de los pasajeros, la puntualidad y la ocupación de los trenes de "FerroIberia", unificando datos de múltiples fuentes y aplicando técnicas avanzadas de modelado y DAX.</p>
        </div>

        <!-- Imagen del Resultado Esperado -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-semibold text-blue-800 mb-3">Resultado Esperado del Informe</h2>
            <p class="text-gray-700 mb-4">Esta imagen es una maqueta realista del informe final que construiremos. Te servirá como guía visual durante el ejercicio.</p>
            <!-- IMAGEN CORREGIDA PARA APUNTAR A UN ARCHIVO LOCAL -->
            <img src="informe.png" alt="Maqueta del informe final de Power BI para FerroIberia" class="w-full rounded-lg shadow-lg border border-gray-200">
        </div>

        <!-- Acordeón de Fases -->
        
        <!-- Fase 0: Preparación -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 0: Preparación y Datos de Origen</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p>Asegúrate de haber generado y tener listos los 5 archivos de datos. Si no los tienes, usa el script de Python proporcionado anteriormente.</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>`Viajes_2024.csv` (250 líneas)</li>
                    <li>`Viajes_2023.xlsx` (250 líneas)</li>
                    <li>`Lineas.csv` (7 líneas)</li>
                    <li>`Estaciones.xlsx` (10 líneas)</li>
                    <li>`Flota.csv` (8 líneas)</li>
                </ul>
            </div>
        </details>

        <!-- Fase 1: Extracción y Transformación (Power Query) -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 1: Extracción y Transformación (Power Query)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p>El objetivo es limpiar y unificar los datos en un esquema de estrella.</p>
                <ul class="list-disc pl-5 space-y-4">
                    <li><strong>Cargar Orígenes:</strong> Carga los 5 archivos a Power Query ("Transformar datos").</li>
                    <li><strong>Unificar Tablas de Viajes:</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Selecciona la consulta `Viajes_2023`.</li>
                            <li>Renombra todas sus columnas para que coincidan <strong>exactamente</strong> con `Viajes_2024` (ej. `Fecha_Operacion` -> `Fecha`, `Cod_Linea` -> `ID_Linea`, etc.).</li>
                            <li>Selecciona la consulta `Viajes_2024`.</li>
                            <li>Ve a "Anexar consultas" (Append Queries) y anexa la consulta `Viajes_2023` (ya limpia) a `Viajes_2024`.</li>
                        </ul>
                    </li>
                    <li><strong>Renombrar Consultas:</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Renombra la consulta unificada (la `Viajes_2024` que ahora tiene 500 filas) a `Fact_Viajes`.</li>
                            <li>Renombra `Lineas` a `Dim_Lineas`.</li>
                            <li>Renombra `Estaciones` a `Dim_Estaciones`.</li>
                            <li>Renombra `Flota` a `Dim_Flota`.</li>
                        </ul>
                    </li>
                    <li><strong>Limpiar Tipos de Datos:</strong> En `Fact_Viajes`, asegura que `Fecha` sea tipo *Fecha*, `Pasajeros` y `Retraso_Minutos` sean *Número entero*, e `Ingresos` sea *Número decimal*.</li>
                    <li><strong>Deshabilitar Carga:</strong> Haz clic derecho en la consulta original `Viajes_2023` y desmarca "Habilitar carga".</li>
                    <li><strong>Cargar y Aplicar:</strong> Haz clic en "Cerrar y aplicar".</li>
                </ul>
            </div>
        </details>
        
        <!-- Fase 2: Modelado de Datos -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 2: Modelado de Datos (Esquema de Estrella)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p>Construirás un modelo de datos robusto con una dimensión de doble rol (Role-Playing Dimension).</p>
                <ul class="list-disc pl-5 space-y-4">
                    <li><strong>Crear `Dim_Calendario` (DAX):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Ve a "Vista de datos" > "Nueva tabla".</li>
                            <li>Usa el código DAX (ver Fase 3) para crear `Dim_Calendario`.</li>
                            <li>En "Herramientas de tabla", marca `Dim_Calendario` como "Tabla de fechas" usando la columna `[Date]`.</li>
                        </ul>
                        
                        <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md">
                            <h4 class="font-semibold text-lg text-blue-800 mb-3">Nota: ¿Por qué este método? (DAX vs. Power Query vs. Auto)</h4>
                            <p class="text-sm text-gray-700 mb-3">Hemos discutido 3 formas de crear tablas de calendario. Aquí tienes un resumen de por qué elegimos este método:</p>
                            
                            <ol class="list-decimal pl-5 space-y-3">
                                <li>
                                    <strong class="text-gray-800">Método 1: `ADDCOLUMNS(CALENDARAUTO())` (El que usamos)</strong>
                                    <ul class="list-disc pl-5 text-sm">
                                        <li><strong>Pro:</strong> Control total, eficiente (una sola tabla), optimizado para DAX Time Intelligence. Es la práctica recomendada.</li>
                                        <li><strong>Con:</strong> Requiere escribir código DAX.</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong class="text-gray-800">Método 2: Jerarquía Automática de Power BI ("Auto Date/Time")</strong>
                                    <ul class="list-disc pl-5 text-sm">
                                        <li><strong>Pro:</strong> Cero esfuerzo, es automático.</li>
                                        <li><strong>Con:</strong> Mala práctica. Crea tablas ocultas ineficientes para *cada* campo de fecha, infla el modelo y no es flexible.</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong class="text-gray-800">Método 3: Crearla en Power Query (con clics)</strong>
                                    <ul class="list-disc pl-5 text-sm">
                                        <li><strong>Pro:</strong> Muy visual, fácil de combinar con otras fuentes (ej. un Excel de festivos).</li>
                                        <li><strong>Con:</strong> Definir el rango de fechas dinámicamente es un poco más complejo que con `CALENDARAUTO()`.</li>
                                    </ul>
                                </li>
                            </ol>
                            <p class="text-sm font-medium text-blue-700 mt-3"><strong>Conclusión:</strong> El método DAX `ADDCOLUMNS` es la práctica recomendada por ser el más robusto, eficiente y escalable.</p>
                        </div>
                    </li>
                    <li><strong>Crear Relaciones (Vista de Modelo):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>`Dim_Calendario[Date]` (1) -> `Fact_Viajes[Fecha]` (*)</li>
                            <li>`Dim_Lineas[ID_Linea]` (1) -> `Fact_Viajes[ID_Linea]` (*)</li>
                            <li>`Dim_Flota[ID_Tren]` (1) -> `Fact_Viajes[ID_Tren]` (*)</li>
                        </ul>
                    </li>
                    <li><strong>Reto: Relaciones de Doble Rol (Estaciones):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li>Crea una relación <strong>ACTIVA</strong>: `Dim_Estaciones[ID_Estacion]` (1) -> `Fact_Viajes[ID_Estacion_Origen]` (*)</li>
                            <li>Crea una relación <strong>INACTIVA</strong>: `Dim_Estaciones[ID_Estacion]` (1) -> `Fact_Viajes[ID_Estacion_Destino]` (*). (Power BI la creará inactiva automáticamente).</li>
                        </ul>
                    </li>
                    <li><strong>Ocultar Claves Foráneas:</strong> En `Fact_Viajes`, oculta todas las columnas de ID (`ID_Linea`, `ID_Tren`, `ID_Estacion_Origen`, `ID_Estacion_Destino`, `Fecha`) de la vista de informe.</li>
                </ul>
            </div>
        </details>

        <!-- Fase 3: Medidas Avanzadas (DAX) -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 3: Medidas Avanzadas (DAX)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p>Crearás los KPIs centrales del informe. (Sugerencia: crea una "Tabla de Medidas" para organizarlas).</p>
                <p><strong>Código `Dim_Calendario`:</strong></p>
<pre><code>Dim_Calendario = 
ADDCOLUMNS (
    CALENDARAUTO(),
    "Año", YEAR ( [Date] ),
    "Mes", FORMAT ( [Date], "MMMM" ),
    "NumMes", MONTH ( [Date] ),
    "AñoMes", FORMAT ( [Date], "YYYY-MM" )
)
</code></pre>
                <p><strong>Medidas de Rendimiento:</strong></p>
<pre><code>Total Pasajeros = SUM(Fact_Viajes[Pasajeros])
Total Ingresos = SUM(Fact_Viajes[Ingresos])
Total Viajes = COUNTROWS(Fact_Viajes)
Retraso Medio (min) = AVERAGE(Fact_Viajes[Retraso_Minutos])

% de Viajes con Retraso = 
VAR ViajesConRetraso = 
    CALCULATE(
        [Total Viajes],
        Fact_Viajes[Retraso_Minutos] &gt; 0
    )
RETURN
    DIVIDE( ViajesConRetraso, [Total Viajes] )

% Ocupacion Media = 
AVERAGEX(
    Fact_Viajes,
    DIVIDE(
        Fact_Viajes[Pasajeros],
        RELATED(Dim_Flota[Capacidad_Maxima])
    )
)
</code></pre>
                <p><strong>Medidas de Time Intelligence:</strong></p>
<pre><code>Ingresos PY = 
CALCULATE(
    [Total Ingresos],
    SAMEPERIODLASTYEAR(Dim_Calendario[Date])
)

Crecimiento Ingresos YoY = 
DIVIDE( [Total Ingresos] - [Ingresos PY], [Ingresos PY] )
</code></pre>
                <p><strong>Medida de Relación Inactiva (El Reto):</strong></p>
<pre><code>Viajes por Destino = 
CALCULATE(
    [Total Viajes],
    USERELATIONSHIP(
        Dim_Estaciones[ID_Estacion],
        Fact_Viajes[ID_Estacion_Destino]
    )
)
</code></pre>
            </div>
        </details>
        
        <!-- Fase 4: Visualización -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 4: Visualización e Interactividad</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p>Construye un informe de 2 páginas.</p>
                <h4 class="font-semibold text-lg">Página 1: Resumen Operativo</h4>
                <ul class="list-disc pl-5 space-y-2">
                    <li><strong>KPIs (Tarjetas):</strong> `[Total Pasajeros]`, `[Total Ingresos]`, `[Retraso Medio (min)]`, `[% Ocupacion Media]`, `[% de Viajes con Retraso]`.</li>
                    <li><strong>Filtros (Slicers):</strong> `Dim_Calendario[Año]`, `Dim_Estaciones[Region]`, `Dim_Lineas[Tipo_Servicio]`.</li>
                    <li><strong>Tendencia Anual (Gráfico de Área):</strong> Eje X: `Dim_Calendario[Mes]`. Eje Y: `[Total Ingresos]` y `[Ingresos PY]`.</li>
                    <li><strong>Ingresos por Jefe Regional (Gráfico de Barras):</strong> Eje Y: `Dim_Estaciones[Jefe_Regional]`. Eje X: `[Total Ingresos]`.</li>
                    <li><strong>Reto Origen vs. Destino (Gráficos de Anillos):</strong>
                        <ul class="list-circle pl-6 mt-2">
                            <li><strong>Anillo Origen:</strong> Leyenda: `Dim_Estaciones[Nombre_Estacion]`. Valores: `[Total Viajes]`. (Usa un filtro N-Superior = 5).</li>
                            <li><strong>Anillo Destino:</strong> Leyenda: `Dim_Estaciones[Nombre_Estacion]`. Valores: `[Viajes por Destino]`. (Usa un filtro N-Superior = 5).</li>
                        </ul>
                    </li>
                </ul>
                <h4 class="font-semibold text-lg mt-4">Página 2: Análisis de Puntualidad y Flota</h4>
                <ul class="list-disc pl-5 space-y-2">
                    <li><strong>Drill-through (Obtención de detalles):</strong> Configura esta página para que sea un destino de Drill-through desde `Dim_Lineas[Tipo_Servicio]`.</li>
                    <li><strong>Matriz de Rendimiento:</strong> Filas: `Dim_Lineas[Nombre_Linea]`. Valores: `[Total Viajes]`, `[Retraso Medio (min)]`, `[% de Viajes con Retraso]`.</li>
                    <li><strong>Formato Condicional:</strong> En la matriz, aplica "Barras de datos" (rojas) a la columna `[Retraso Medio (min)]`.</li>
                    <li><strong>Correlación (Gráfico Combinado):</strong> Eje X: `Dim_Calendario[Mes]`. Columnas (Y): `[Total Pasajeros]`. Líneas (Y): `[Retraso Medio (min)]`.</li>
                    <li><strong>Detalle de Flota (Gráfico de Barras):</strong> Eje Y: `Dim_Flota[Modelo]`. Eje X: `[% Ocupacion Media]`.</li>
                </ul>
            </div>
        </details>

        <!-- Fase 5: Preguntas de Negocio -->
        <details class="bg-white rounded-lg shadow-sm mb-3">
            <summary class="flex justify-between items-center p-5 cursor-pointer">
                <span class="text-xl font-semibold text-blue-700">Fase 5: Preguntas de Negocio (Validación)</span>
                <span class="plus-minus text-2xl text-blue-700 font-light transform transition-transform duration-200">+</span>
            </summary>
            <div class="p-5 border-t border-gray-200 text-gray-700 space-y-3">
                <p>Usa tu informe interactivo para encontrar las respuestas.</p>
                <ol class="list-decimal pl-5 space-y-4">
                    <li>
                        <strong>Pregunta:</strong> ¿Cuál fue el `Total Ingresos` y el `Retraso Medio` del "Alta Velocidad" en la región "Cataluña" durante 2024?
                        <br><strong>Respuesta:</strong> En la Página 1, selecciona los filtros "2024", "Cataluña" y "Alta Velocidad". Lee las tarjetas de KPI.
                    </li>
                    <li>
                        <strong>Pregunta:</strong> ¿Qué Jefe Regional (`Jefe_Regional`) gestiona las estaciones con más viajes (como origen)?
                        <br><strong>Respuesta:</strong> En la Página 1, mira el gráfico de "Ingresos por Jefe Regional". (Nota: el gráfico es de ingresos, pero la pregunta es sobre viajes. ¡Podrías cambiar el gráfico a `[Total Viajes]` para responderla con más precisión!).
                    </li>
                    <li>
                        <strong>Pregunta:</strong> Usando la Página 1, ¿cuál es la estación de destino (`Nombre_Estacion`) más popular?
                        <br><strong>Respuesta:</strong> Mira el gráfico "Top 5 Estaciones de Destino".
                    </li>
                    <li>
                        <strong>Pregunta:</strong> Usando el drill-through a la Página 2 para "Cercanías", ¿qué línea (`Nombre_Linea`) tiene el peor `[% de Viajes con Retraso]`?
                        <br><strong>Respuesta:</strong> En la Página 1, haz clic derecho en el filtro "Cercanías" > "Obtención de detalles" > "Análisis Detalle". Mira la matriz en la Página 2.
                    </li>
                </ol>
            </div>
        </details>
        
        <footer class="text-center text-gray-500 mt-8">
            <p>Fin del ejercicio. ¡Buen trabajo!</p>
        </footer>
    </div>

</body>
</html>
